// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"

}

model User {
  userid        Int      @id @default(autoincrement())
  username      String   @unique
  email         String   @unique
  password_hash String
  role          String
  date_joined   DateTime @default(now())

  // Relations
  recipes     Recipe[]
  collections Collection[]
  reviews     Review[]
}

model Ingredient {
  ingredient_id Int     @id @default(autoincrement())
  name          String
  unit          String?

  // Relations
  recipeIngredients RecipeIngredient[]
}

model Recipe {
  recipe_id   Int      @id @default(autoincrement())
  user_id     Int
  title       String
  description String?
  is_public   Boolean  @default(false)
  prep_time   Int? // in minutes
  cook_time   Int? // in minutes
  servings    Int?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  avg_rating  Float    @default(0)

  // Relations
  user              User               @relation(fields: [user_id], references: [userid])
  steps             Step[]
  recipeIngredients RecipeIngredient[]
  recipeTags        RecipeTag[]
  reviews           Review[]
  collectionItems   CollectionItem[]
}

model RecipeIngredient {
  recipe_id     Int
  ingredient_id Int

  // Relations
  recipe     Recipe     @relation(fields: [recipe_id], references: [recipe_id])
  ingredient Ingredient @relation(fields: [ingredient_id], references: [ingredient_id])

  @@id([recipe_id, ingredient_id])
}

model Step {
  step_id     Int    @id @default(autoincrement())
  recipe_id   Int
  step_number Int
  instruction String

  // Relations
  recipe Recipe @relation(fields: [recipe_id], references: [recipe_id])
}

model Tag {
  tag_id Int    @id @default(autoincrement())
  name   String @unique

  recipeTags RecipeTag[]
}

model RecipeTag {
  recipe_id Int
  tag_id    Int

  recipe Recipe @relation(fields: [recipe_id], references: [recipe_id])
  tag    Tag    @relation(fields: [tag_id], references: [tag_id])

  @@id([recipe_id, tag_id])
}

model Collection {
  collection_id Int    @id @default(autoincrement())
  user_id       Int
  name          String

  user  User             @relation(fields: [user_id], references: [userid])
  items CollectionItem[]
}

model CollectionItem {
  collection_id Int
  recipe_id     Int

  collection Collection @relation(fields: [collection_id], references: [collection_id])
  recipe     Recipe     @relation(fields: [recipe_id], references: [recipe_id])

  @@id([collection_id, recipe_id])
}

model Review {
  review_id  Int      @id @default(autoincrement())
  user_id    Int
  recipe_id  Int
  rating     Int
  comment    String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user   User   @relation(fields: [user_id], references: [userid])
  recipe Recipe @relation(fields: [recipe_id], references: [recipe_id])
}
